import{i as e,d as l,f as t}from"./index-3a23732c.js";import{_ as a,l as o}from"./lodash-9fee43d9.js";import"./vue-echarts-85a407f1.js";import{a as n}from"./element-plus-f16307a8.js";import{u as i}from"./index-538f59ff.js";import{_ as r}from"./menu-check.vue_vue_type_style_index_0_lang-e2df903e.js";import{d as u,R as s,o as p,I as c,J as d,b as m,e as b,p as v,c as f,V as h,F as w,N as y,a as g}from"./@vue.runtime-core-4f5b9f62.js";import{_ as C}from"./_plugin-vue_export-helper-c4cb8a60.js";import{u as k,d as _}from"./vue-router-18ffceba.js";import"./store-96e17a43.js";import{e as I,u as x}from"./@vue.reactivity-bec702f3.js";import{L as j}from"./@vue.shared-5670d8a7.js";import"./@vue.runtime-dom-c19fd55a.js";import"./axios-966d6f38.js";import"./nprogress-6d1393d1.js";import"./lodash-es-a085e596.js";import"./pinia-dbeeb1e2.js";import"./vue-demi-5b9a0fa5.js";import"./@vueuse.core-d0bf94bd.js";import"./@vueuse.shared-3f1de09b.js";import"./vue-2b98d5da.js";import"./mockjs-93ca2bc8.js";import"./mitt-dab1f1cb.js";import"./@element-plus.icons-vue-c0c6c02f.js";import"./@popperjs.core-040feab9.js";import"./@ctrl.tinycolor-84ad98d6.js";import"./dayjs-dd470533.js";import"./async-validator-efc2d198.js";import"./memoize-one-99e54574.js";import"./escape-html-4bbaf1e1.js";import"./normalize-wheel-es-da779ce4.js";import"./@floating-ui.dom-9d85c32a.js";import"./@floating-ui.core-c56fb7e8.js";import"./resize-detector-94afada7.js";import"./echarts-33de40b3.js";import"./tslib-ed971494.js";import"./zrender-d158d5d4.js";const T=C(u({name:"news-comment-list",props:{articleId:{type:Number,default:null}},setup(t){const{service:o}=i(),n=e.exports.useUpsert({items:[{label:"上層評論",prop:"parentId",component:{name:"el-select",options:[],props:{clearable:!0,filterable:!0}}},{label:"文章ID",prop:"articleId",value:t.articleId,hidden:!0,component:{name:"el-input"}},{label:"評論者",prop:"authorId",required:!0,component:{name:"el-select",options:[],props:{clearable:!0,filterable:!0}}},{label:"內容",prop:"content",component:{name:"el-input",props:{type:"textarea",rows:4}},required:!0},{label:"狀態",prop:"isDelete",value:!1,component:{name:"cl-switch",props:{"active-color":"#ff4949"}}}],onOpen:async e=>{var l,i;const r=await o.base.sys.user.list();a.isEmpty(r)||null==(l=n.value)||l.setOptions("authorId",null==r?void 0:r.map((e=>({label:`${e.name} (ID:${e.id})`,value:String(e.id)}))));const u=await o.news.comment.list({articleId:t.articleId,parent:!0});a.isEmpty(u)||null==(i=n.value)||i.setOptions("parentId",u.map((e=>({label:`${e.id}. ${e.content}`,value:String(e.id)}))))},onInfo:async(e,{next:l})=>{l(e)},onSubmit(e,{next:l}){l({...e,articleId:t.articleId})}}),r=e.exports.useTable({columns:[{type:"selection"},{label:"ID",prop:"id",minWidth:80},{label:"內容",prop:"content",align:"left",minWidth:300},{label:"評論者",prop:"author",minWidth:150},{label:"讚數",prop:"likeCount",minWidth:100},{label:"狀態",prop:"isDelete",minWidth:120,dict:[{label:"正常",value:0,type:"success"},{label:"刪除",value:1,type:"danger"}]},{label:"創建時間",prop:"createTime",minWidth:200},{label:"更新時間",prop:"updateTime",minWidth:200},{label:"刪除時間",prop:"deleteTime",minWidth:200},{type:"op",buttons:["edit","delete"]}]});const u=e.exports.useCrud({service:o.news.comment,async onRefresh(e,{next:o,render:n}){const{list:i}=await o({...e,articleId:t.articleId});if(a.isEmpty(i))return n(i);n(l(i.map((e=>(e.isDelete=Boolean(e.deleteTime),e)))))}},(e=>{e.refresh()}));return{commentUpsert:n,commentTable:r,onRowClick:function(e,l){var t;(null==l?void 0:l.property)&&e.children&&(null==(t=r.value)||t.toggleRowExpansion(e))},commentCrud:u}}}),[["render",function(e,l,t,a,o,n){const i=s("cl-refresh-btn"),r=s("cl-add-btn"),u=s("cl-multi-delete-btn"),b=s("el-row"),v=s("cl-table"),f=s("cl-flex1"),h=s("cl-upsert"),w=s("cl-crud");return p(),c(w,{ref:"commentCrud"},{default:d((()=>[m(b,null,{default:d((()=>[m(i),m(r),m(u)])),_:1}),m(b,null,{default:d((()=>[m(v,{"auto-height":!1,ref:"commentTable","row-key":"id",onRowClick:e.onRowClick},null,8,["onRowClick"])])),_:1}),m(b,null,{default:d((()=>[m(f)])),_:1}),m(h,{ref:"commentUpsert"},null,512)])),_:1},512)}]]);const W=C(u({name:"news-view-list",props:{articleId:{type:Number,default:null}},setup(l){const{service:t}=i(),a=e.exports.useTable({columns:[{label:"ID",prop:"id",minWidth:80},{label:"用戶ID",prop:"userId",align:"left",minWidth:300},{label:"用戶名稱",prop:"name",minWidth:150},{label:"瀏覽時間",prop:"createTime",minWidth:200},{type:"op",buttons:["edit","delete"]}]});const o=e.exports.useCrud({service:t.news.article.views,async onRefresh(e,{render:a}){const{list:o,pagination:n}=await t.news.article.views({...e,articleId:l.articleId});a(o,n)}},(e=>{e.refresh()}));return{Table:a,onRowClick:function(e,l){var t;(null==l?void 0:l.property)&&e.children&&(null==(t=a.value)||t.toggleRowExpansion(e))},Crud:o}}}),[["render",function(e,l,t,a,o,n){const i=s("cl-refresh-btn"),r=s("el-row"),u=s("cl-table"),b=s("cl-flex1"),v=s("cl-crud");return p(),c(v,{ref:"Crud"},{default:d((()=>[m(r,null,{default:d((()=>[m(i)])),_:1}),m(r,null,{default:d((()=>[m(u,{"auto-height":!1,ref:"Table","row-key":"id",onRowClick:e.onRowClick},null,8,["onRowClick"])])),_:1}),m(r,null,{default:d((()=>[m(b)])),_:1})])),_:1},512)}]]);const R=C(u({name:"news-collection-list",props:{articleId:{type:Number,default:null}},setup(l){const{service:t}=i(),a=e.exports.useTable({columns:[{label:"ID",prop:"id",minWidth:80},{label:"用戶ID",prop:"userId",align:"left",minWidth:300},{label:"用戶名稱",prop:"name",minWidth:150},{label:"瀏覽時間",prop:"createTime",minWidth:200},{type:"op",buttons:["edit","delete"]}]});const o=e.exports.useCrud({service:t.news.article.collections,async onRefresh(e,{render:a}){const{list:o,pagination:n}=await t.news.article.collections({...e,articleId:l.articleId});a(o,n)}},(e=>{e.refresh()}));return{Table:a,onRowClick:function(e,l){var t;(null==l?void 0:l.property)&&e.children&&(null==(t=a.value)||t.toggleRowExpansion(e))},Crud:o}}}),[["render",function(e,l,t,a,o,n){const i=s("cl-refresh-btn"),r=s("el-row"),u=s("cl-table"),b=s("cl-flex1"),v=s("cl-crud");return p(),c(v,{ref:"Crud"},{default:d((()=>[m(r,null,{default:d((()=>[m(i)])),_:1}),m(r,null,{default:d((()=>[m(u,{"auto-height":!1,ref:"Table","row-key":"id",onRowClick:e.onRowClick},null,8,["onRowClick"])])),_:1}),m(r,null,{default:d((()=>[m(b)])),_:1})])),_:1},512)}]]);const V=C(u({name:"news-like-list",props:{articleId:{type:Number,default:null}},setup(l){const{service:t}=i(),a=e.exports.useTable({columns:[{label:"ID",prop:"id",minWidth:80},{label:"用戶ID",prop:"userId",align:"left",minWidth:300},{label:"用戶名稱",prop:"name",minWidth:150},{label:"瀏覽時間",prop:"createTime",minWidth:200},{type:"op",buttons:["edit","delete"]}]});const o=e.exports.useCrud({service:t.news.article.likes,async onRefresh(e,{render:a}){const{list:o,pagination:n}=await t.news.article.likes({...e,articleId:l.articleId});a(o,n)}},(e=>{e.refresh()}));return{Table:a,onRowClick:function(e,l){var t;(null==l?void 0:l.property)&&e.children&&(null==(t=a.value)||t.toggleRowExpansion(e))},Crud:o}}}),[["render",function(e,l,t,a,o,n){const i=s("cl-refresh-btn"),r=s("el-row"),u=s("cl-table"),b=s("cl-flex1"),v=s("cl-crud");return p(),c(v,{ref:"Crud"},{default:d((()=>[m(r,null,{default:d((()=>[m(i)])),_:1}),m(r,null,{default:d((()=>[m(u,{"auto-height":!1,ref:"Table","row-key":"id",onRowClick:e.onRowClick},null,8,["onRowClick"])])),_:1}),m(r,null,{default:d((()=>[m(b)])),_:1})])),_:1},512)}]]),q=u({name:"news-article"}),D=u({...q,setup(a){var u,C;const q=k(),D=_(),{service:U}=i(),{dict:E}=t(),N=null==(u=E.get("articleType").value.find((e=>"一般新聞"===e.label)))?void 0:u.value,O=null==(C=E.get("articleType").value.find((e=>"影音新聞"===e.label)))?void 0:C.value,z=e.exports.useUpsert({dialog:{fullscreen:!0},items:[{label:"類型",prop:"type",value:N,component:{name:"el-select",options:E.get("articleType")},required:!0},{label:"標題",prop:"title",required:!0,component:{name:"el-input"}},{label:"代稱",prop:"slug",required:!0,component:{name:"el-input"}},{label:"影片網址",prop:"videoUrl",component:{name:"el-input"},hidden:({scope:e})=>e.type!==O},{label:"完整文章",prop:"content",component:{name:"cl-editor-wang"},required:!0},{label:"預覽內容",prop:"contentPreview",required:!0,component:{name:"cl-editor-wang"}},{label:"摘錄",prop:"excerpt",component:{name:"el-input",props:{type:"textarea",rows:4}}},{label:"meta標題",prop:"metaTitle",component:{name:"el-input"}},{label:"meta描述",prop:"metaDescription",component:{name:"el-input",props:{type:"textarea",rows:4}}},{label:"作者頭像",prop:"authorAvatar",component:{name:"cl-upload"}},{label:"作者姓名",prop:"authorName",required:!0,component:{name:"el-input"}},{label:"作者簡介",prop:"authorIntro",component:{name:"cl-editor-wang",props:{height:250}}},{label:"縮圖",prop:"thumbnail",component:{name:"cl-upload"}},{label:"分類",prop:"categories",required:!0,component:{vm:r}},{label:"開啟評論",prop:"commentOpen",required:!0,component:{name:"el-switch"}},{label:"置頂新聞",prop:"isTop",required:!0,component:{name:"el-switch"}},{label:"熱門新聞",prop:"isHot",required:!0,component:{name:"el-switch"}},{label:"狀態",prop:"status",component:{name:"el-select",options:E.get("articleStatus")},required:!0},{label:"發布時間",prop:"publishTime",component:{name:"el-date-picker",props:{type:"datetime",valueFormat:"YYYY-MM-DD HH:mm:ss"}}}]}),H=e.exports.useTable({columns:[{type:"selection"},{label:"類型",prop:"type",minWidth:100,dict:E.get("articleType")},{label:"焦點",prop:"isTop",component:{name:"cl-switch"},minWidth:110},{label:"熱門",prop:"isHot",component:{name:"cl-switch"},minWidth:110},{label:"縮圖",prop:"thumbnail",minWidth:100},{label:"狀態",prop:"status",minWidth:130,dict:E.get("articleStatus")},{label:"標題",prop:"title",minWidth:300,align:"left"},{label:"分類",prop:"categories",minWidth:150},{label:"作者",prop:"authorName",minWidth:130},{label:"評論",prop:"commentCount",minWidth:100},{label:"閱讀",prop:"viewCount",minWidth:100},{label:"按讚",prop:"likeCount",minWidth:100},{label:"收藏",prop:"collectionCount",minWidth:100},{label:"評論開啟",prop:"commentOpen",component:{name:"cl-switch"},minWidth:110},{label:"發布時間",prop:"publishTime",sortable:"custom",minWidth:200},{label:"創建時間",prop:"createTime",sortable:"custom",minWidth:200},{label:"更新時間",prop:"updateTime",sortable:"custom",minWidth:200},{type:"op",buttons:["slot-comment","edit","delete"],width:250}]}),S=I(!1),B=I(0),Y=I("");function $({id:e}){var l;const{title:t}=null==(l=H.value)?void 0:l.data.find((l=>l.id===e));Y.value=t,S.value=!0,B.value=e}const P=I(!1),F=I(0),M=I("");const A=I(!1),J=I(0),L=I("");const G=I(!1),K=I(0),Q=I("");const X=I(""),Z=I([]),ee=I([]);b((()=>{U.industry.category.list({type:"article"}).then((e=>{Z.value=e,ee.value=e.filter((e=>"0"!==e.articleCount||!e.parentId)),ee.value=l(ee.value),ee.value=ee.value.map((e=>{var l;e.children=null!=(l=e.children)?l:[];const t=e.children.map((e=>({label:e.name,value:e.id,parentId:e.parentId}))),a=e.children.reduce(((e,l)=>o.exports.add(e.articleCount,l.articleCount)),0);return{label:e.name,options:[{label:"全部",value:e.id,disabled:0===a,parentId:null},...t]}}))})).catch((e=>{n.error(e.message)}))}));const le=I(null),te=I(null);b((()=>{const e={type:le,status:te,categoryId:X,categoryParentId:X};Object.keys(q.query).forEach((l=>{e[l]&&(e[l].value=Number(q.query[l])||q.query[l])}))}));const ae=I(!0),oe=e.exports.useCrud({service:U.news.article,async onRefresh(e,{render:l}){Object.keys(q.query).length>0&&ae.value&&(e=q.query),ae.value=!1;const t=X.value,a=Z.value.find((e=>!e.parentId&&e.id===t))?{categoryParentId:t}:{categoryId:t};e=t?{...e,...a}:e,D.replace({path:q.path,query:e}),U.news.article.page(e).then((e=>{const{list:t,pagination:a}=e;t.forEach((e=>{e.categories?e.categories=e.categories.split(",").map(Number):e.categories=[],e.isHot=Boolean(e.isHot),e.isTop=Boolean(e.isTop),e.commentOpen=Boolean(e.commentOpen)})),l(t,a)}))}},(e=>{e.refresh()}));v(X,(()=>{var e;null==(e=oe.value)||e.refresh()})),b((()=>{}));const ne=e=>{var l;const t=E.get("articleType").value;if(t.length)return null==(l=t.find((l=>l.value===e)))?void 0:l.label};return(e,l)=>{const t=s("cl-refresh-btn"),a=s("cl-add-btn"),o=s("cl-multi-delete-btn"),n=s("cl-flex1"),i=s("el-option"),r=s("el-option-group"),u=s("el-select"),b=s("cl-select"),v=s("cl-search-key"),C=s("el-row"),k=s("el-avatar"),_=s("el-tag"),I=s("el-button"),q=s("cl-table"),D=s("cl-pagination"),U=s("cl-upsert"),N=s("cl-dialog"),O=s("cl-crud");return p(),c(O,{ref_key:"Crud",ref:oe},{default:d((()=>[m(C,null,{default:d((()=>[m(t),m(a),m(o),m(n),m(u,{style:{"margin-right":"10px"},modelValue:X.value,"onUpdate:modelValue":l[0]||(l[0]=e=>X.value=e),clearable:"",placeholder:"請選擇"},{default:d((()=>[(p(!0),f(w,null,h(ee.value,(e=>(p(),c(r,{key:e.value,label:e.label},{default:d((()=>[(p(!0),f(w,null,h(e.options,(e=>(p(),c(i,{key:e.value,label:e.label,value:e.value,disabled:e.disabled},{default:d((()=>[g("span",null,j(e.label),1)])),_:2},1032,["label","value","disabled"])))),128))])),_:2},1032,["label"])))),128))])),_:1},8,["modelValue"]),m(b,{modelValue:le.value,"onUpdate:modelValue":l[1]||(l[1]=e=>le.value=e),style:{"margin-right":"10px"},options:x(E).get("articleType"),prop:"type"},null,8,["modelValue","options"]),m(b,{modelValue:te.value,"onUpdate:modelValue":l[2]||(l[2]=e=>te.value=e),options:x(E).get("articleStatus"),prop:"status"},null,8,["modelValue","options"]),m(v)])),_:1}),m(C,null,{default:d((()=>[m(q,{ref_key:"Table",ref:H},{"column-thumbnail":d((({scope:e})=>[m(k,{shape:"square",size:50,src:e.row.thumbnail},null,8,["src"])])),"column-type":d((({scope:e})=>[m(_,{"disable-transitions":"",size:"small",effect:"dark",style:{margin:"2px",cursor:"pointer"},onClick:l=>le.value=e.row.type},{default:d((()=>[y(j(ne(e.row.type)),1)])),_:2},1032,["onClick"])])),"column-commentCount":d((({scope:e})=>[m(I,{text:"",onClick:l=>$(e.row)},{default:d((()=>[y(j(e.row.commentCount),1)])),_:2},1032,["onClick"])])),"column-viewCount":d((({scope:e})=>[m(I,{text:"",onClick:l=>function({id:e}){var l;const{title:t}=null==(l=H.value)?void 0:l.data.find((l=>l.id===e));M.value=t,P.value=!0,F.value=e}(e.row)},{default:d((()=>[y(j(e.row.viewCount),1)])),_:2},1032,["onClick"])])),"column-likeCount":d((({scope:e})=>[m(I,{text:"",onClick:l=>function({id:e}){var l;const{title:t}=null==(l=H.value)?void 0:l.data.find((l=>l.id===e));L.value=t,A.value=!0,J.value=e}(e.row)},{default:d((()=>[y(j(e.row.likeCount),1)])),_:2},1032,["onClick"])])),"column-collectionCount":d((({scope:e})=>[m(I,{text:"",onClick:l=>function({id:e}){var l;const{title:t}=null==(l=H.value)?void 0:l.data.find((l=>l.id===e));Q.value=t,G.value=!0,K.value=e}(e.row)},{default:d((()=>[y(j(e.row.collectionCount),1)])),_:2},1032,["onClick"])])),"column-categories":d((({scope:e})=>[(p(!0),f(w,null,h(e.row.categories,((e,l)=>(p(),c(_,{key:l,"disable-transitions":"",size:"small",effect:"dark",style:{margin:"2px",cursor:"pointer"},onClick:l=>X.value=e},{default:d((()=>{var l;return[y(j(null==(l=Z.value.find((l=>l.id===e)))?void 0:l.name),1)]})),_:2},1032,["onClick"])))),128))])),"slot-comment":d((({scope:e})=>[m(I,{type:"success",class:"is-has-bg is-text",onClick:l=>$(e.row)},{default:d((()=>[y("評論")])),_:2},1032,["onClick"])])),_:1},512)])),_:1}),m(C,null,{default:d((()=>[m(n),m(D)])),_:1}),m(U,{ref_key:"Upsert",ref:z},null,512),m(N,{title:Y.value,width:"90%",height:"100%",modelValue:S.value,"onUpdate:modelValue":l[4]||(l[4]=e=>S.value=e)},{default:d((()=>[m(T,{onClose:l[3]||(l[3]=e=>S.value=!1),visible:S.value,"article-id":B.value},null,8,["visible","article-id"])])),_:1},8,["title","modelValue"]),m(N,{title:M.value,width:"90%",height:"100%",modelValue:P.value,"onUpdate:modelValue":l[6]||(l[6]=e=>P.value=e)},{default:d((()=>[m(W,{onClose:l[5]||(l[5]=e=>P.value=!1),visible:P.value,"article-id":F.value},null,8,["visible","article-id"])])),_:1},8,["title","modelValue"]),m(N,{title:L.value,width:"90%",height:"100%",modelValue:A.value,"onUpdate:modelValue":l[8]||(l[8]=e=>A.value=e)},{default:d((()=>[m(V,{onClose:l[7]||(l[7]=e=>A.value=!1),visible:A.value,"article-id":J.value},null,8,["visible","article-id"])])),_:1},8,["title","modelValue"]),m(N,{title:Q.value,width:"90%",height:"100%",modelValue:G.value,"onUpdate:modelValue":l[10]||(l[10]=e=>G.value=e)},{default:d((()=>[m(R,{onClose:l[9]||(l[9]=e=>G.value=!1),visible:G.value,"article-id":K.value},null,8,["visible","article-id"])])),_:1},8,["title","modelValue"])])),_:1},512)}}});export{D as default};
